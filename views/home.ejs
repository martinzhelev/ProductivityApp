<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard with Bootstrap</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/amblezio.css">
    <link rel="stylesheet" href="/css/home.css">
</head>

<body>

    <header class="bg-dark text-white p-3 rounded-xl glow">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="profile d-flex align-items-center">
                <span class="avatar me-2">M</span>
                <span class="ms-2">
                    <%= username %>
                </span>
            </div>
            <button class="btn btn-outline-light" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasNavbar">
                ‚ò∞
            </button>
        </div>
    </header>

    <!-- Offcanvas Menu -->
    <div class="offcanvas offcanvas-end rounded-xl" tabindex="-1" id="offcanvasNavbar">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">Menu</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="/home/<%= userId %>">üè† Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/subscribe/<%= userId %>">üí≥ Payments</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/profile/<%= userId %>">üë§ Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/work/<%= userId %>">üíº Work</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/mental/<%= userId %>">üß† Mental</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/calorietracker/<%= userId %>">üçΩÔ∏è Calorie Tracker</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/social/<%= userId %>">üë• Social</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/timeoff/<%= userId %>">‚è∞ Time Off</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/body/<%= userId %>">üí™ Body</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/auth/logout">üö™ Logout</a>
                </li>
            </ul>
        </div>
    </div>

    <main class="container mt-4">
        <div class="row">
            <!-- Left Column: Tasks -->
            <div class="col-md-4 position-relative">
                <div class="column glass p-4">
                    <h2 class="mb-3">Tasks</h2>
                    <ul class="tasks list-unstyled" id="tasks-list">
                        <% if (tasks.length> 0) { %>
                            <% tasks.forEach(function(task) { %>
                                <li data-task-id="<%= task.task_id %>" class="<%= task.completed ? 'completed' : '' %>">
                                    <div class="d-flex align-items-center">
                                        <input type="checkbox" class="checkbox me-2" <%=task.completed ? 'checked' : '' %> >
                                        <span><%= task.task %></span>
                                    </div>
                                    <button class="btn btn-icon btn-danger delete-task" data-id="<%= task.task_id %>" title="Delete"><i class="fas fa-trash"></i></button>
                                </li>
                            <% }); %>
                        <% } else { %>
                            <li>No tasks found</li>
                        <% } %>
                    </ul>
                    <button class="fab" id="addTask">+</button>
                    <button class="btn btn-danger mt-2 w-100" id="removeTask">Remove Done Tasks</button>
                </div>
            </div>


            <!-- Middle Column: Habits -->
            <div class="col-md-4 position-relative">
                <div class="column glass p-4">
                    <h2 class="mb-3">Habits</h2>
                    <ul class="habits list-unstyled d-grid gap-2" id="habits-list">
                        <% if (habits.length> 0) { %>
                            <% habits.forEach(function(habit) { %>
                                <li data-habit-id="<%= habit.habit_id %>">
                                    <div class="chip <%= habit.category === 'Mental' ? 'purple' : (habit.category === 'Strength' ? 'green' : 'blue') %>">
                                        <span class="icon">üí†</span>
                                        <label class="m-0 d-flex align-items-center">
                                            <input type="checkbox" class="checkbox me-2" <%=habit.completed ? 'checked' : '' %> >
                                            <span><%= habit.habit %></span>
                                        </label>
                                    </div>
                                    <button class="btn btn-icon btn-danger delete-task" data-id="<%= habit.habit_id %>" title="Delete"><i class="fas fa-trash"></i></button>
                                </li>
                            <% }); %>
                        <% } else { %>
                            <li>No habits found</li>
                        <% } %>
                    </ul>
                    <button class="fab" id="addHabit">+</button>
                    <button class="btn btn-danger mt-2 w-100" id="removeHabit">Remove Habits</button>
                </div>
            </div>

            <!-- Right Column: Stats -->
            <div class="col-md-4">
                <div class="column glass p-4">
                    <h2 class="mb-3">Player Stats</h2>
                    <div class="stats d-grid gap-3">
                        <% if (stats) { %>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span>Strength</span><span><%= stats.strength || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-red" style="--p:<%= stats.strength || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span>Agility</span><span><%= stats.agility || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-orange" style="--p:<%= stats.agility || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span>Mental</span><span><%= stats.mental || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-purple" style="--p:<%= stats.mental || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span>Work</span><span><%= stats.work || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-blue" style="--p:<%= stats.work || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span>Social</span><span><%= stats.social || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-teal" style="--p:<%= stats.social || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span>Financial</span><span><%= stats.financial || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-green" style="--p:<%= stats.financial || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span>Speed</span><span><%= stats.speed || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-yellow" style="--p:<%= stats.speed || 0 %>;"></span></div>
                            </div>
                            <% } else { %>
                                <p>No stats available</p>
                                <% } %>
                    </div>
                </div>
            </div>


            <div class="modal" id="task-modal">
                <div class="modal-header">
                    <span class="title">Add Task</span>
                    <span class="close-button" id="close-task-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <input type="text" name="task" id="task-input" placeholder="Enter your task" />
                    <select id="task-category" class="form-select">
                        <option value="" disabled selected>Select Category</option>
                        <option value="Strength">Strength</option>
                        <option value="Agility">Agility</option>
                        <option value="Mental">Mental</option>
                        <option value="Work">Work</option>
                        <option value="Social">Social</option>
                        <option value="Financial">Financial</option>
                        <option value="Speed">Speed</option>
                    </select>
                    <button id="modal-add-task">Add Task</button>
                </div>
            </div>
            <div class="modal" id="habit-modal">
                <div class="modal-header">
                    <span class="title">Add Habit</span>
                    <span class="close-button" id="close-habit-modal">&times;</span>
                </div>
                <div class="modal-body">
                    <input type="text" name="habit" id="habit-input" placeholder="Enter your habit" />
                    <select id="habit-category" class="form-select">
                        <option value="" disabled selected>Select Category</option>
                        <option value="Strength">Strength</option>
                        <option value="Agility">Agility</option>
                        <option value="Mental">Mental</option>
                        <option value="Work">Work</option>
                        <option value="Social">Social</option>
                        <option value="Financial">Financial</option>
                        <option value="Speed">Speed</option>
                    </select>
                    <button id="modal-add-habit">Add Habit</button>
                </div>
            </div>
            <div id="overlay"></div>


    </main>

    <div id="user-info" data-user-id="<%= userId %>"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/frontendJS/homeFE.js"></script>
</body>

</html>