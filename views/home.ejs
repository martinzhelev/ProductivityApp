<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Dashboard with Bootstrap</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/amblezio.css">
    <link rel="stylesheet" href="/css/home.css">
</head>

<body class="bg-dark text-light">

    <header class="bg-dark text-white p-3 rounded-xl glow">
        <div class="container d-flex justify-content-between align-items-center">
            <div class="profile d-flex align-items-center">
                <span class="avatar me-2">M</span>
                <span class="ms-2">
                    <%= username %>
                </span>
            </div>
            <button class="btn btn-outline-light" type="button" data-bs-toggle="offcanvas"
                data-bs-target="#offcanvasNavbar">
                ‚ò∞
            </button>
        </div>
    </header>

    <!-- Offcanvas Menu -->
    <div class="offcanvas offcanvas-end rounded-xl text-bg-dark" tabindex="-1" id="offcanvasNavbar">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title text-light">Menu</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link text-light" href="/home/<%= userId %>">üè† Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/subscribe/<%= userId %>">üí≥ Payments</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/profile/<%= userId %>">üë§ Profile</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/work/<%= userId %>">üíº Work</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/mental/<%= userId %>">üß† Mental</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/calorietracker/<%= userId %>">üçΩÔ∏è Calorie Tracker</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/social/<%= userId %>">üë• Social</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/timeoff/<%= userId %>">‚è∞ Time Off</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/body/<%= userId %>">üí™ Body</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-light" href="/auth/logout">üö™ Logout</a>
                </li>
            </ul>
        </div>
    </div>

    <main class="container mt-4">
        <div class="row">
            <!-- Left Column: Tasks -->
            <div class="col-md-4 position-relative">
                <div class="column glass p-4 bg-dark text-light border border-secondary rounded-3">
                    <h2 class="mb-3 text-light">Tasks</h2>
                    <ul class="tasks list-unstyled" id="tasks-list">
                        <% if (tasks.length> 0) { %>
                            <% tasks.forEach(function(task) { %>
                                <li data-task-id="<%= task.task_id %>" class="<%= task.completed ? 'completed ' : '' %>bg-body-tertiary text-light border border-secondary rounded-3 p-2 d-flex justify-content-between align-items-center mb-2">
                                    <div class="d-flex align-items-center flex-grow-1">
                                        <input type="checkbox" class="checkbox form-check-input me-2" <%=task.completed ? 'checked' : '' %> >
                                        <span class="text-light"><%= task.task %></span>
                                    </div>
                                    <button class="btn btn-sm btn-outline-danger delete-task ms-2" data-id="<%= task.task_id %>" title="Delete"><i class="fas fa-trash"></i></button>
                                </li>
                            <% }); %>
                        <% } else { %>
                            <li class="bg-body-tertiary text-light border border-secondary rounded-3 p-2 d-flex justify-content-between align-items-center mb-2">No tasks found</li>
                        <% } %>
                    </ul>
                    <button class="btn btn-danger mt-2 w-100" id="removeTask">Remove Done Tasks</button>
                    <button class="fab btn btn-primary position-absolute end-0 bottom-0 me-3 mb-3 rounded-circle shadow" id="addTask" aria-label="Add task">+</button>
                </div>
            </div>


            <!-- Middle Column: Habits -->
            <div class="col-md-4 position-relative">
                <div class="column glass p-4 bg-dark text-light border border-secondary rounded-3">
                    <h2 class="mb-3 text-light">Habits</h2>
                    <ul class="habits list-unstyled d-grid gap-2" id="habits-list">
                        <% if (habits.length> 0) { %>
                            <% habits.forEach(function(habit) { %>
                                <li data-habit-id="<%= habit.habit_id %>" class="bg-body-tertiary text-light border border-secondary rounded-3 p-2 d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center flex-grow-1">
                                        <label class="m-0 d-flex align-items-center">
                                            <input type="checkbox" class="checkbox form-check-input me-2" <%=habit.completed ? 'checked' : '' %> >
                                            <span class="text-light"><%= habit.habit %></span>
                                        </label>
                                    </div>
                                    <button class="btn btn-sm btn-outline-danger delete-task ms-2" data-id="<%= habit.habit_id %>" title="Delete"><i class="fas fa-trash"></i></button>
                                </li>
                            <% }); %>
                        <% } else { %>
                            <li class="bg-body-tertiary text-light border border-secondary rounded-3 p-2 d-flex justify-content-between align-items-center mb-2">No habits found</li>
                        <% } %>
                    </ul>
                    <button class="btn btn-danger mt-2 w-100" id="removeHabit">Remove Habits</button>
                    <button class="fab btn btn-primary position-absolute end-0 bottom-0 me-3 mb-3 rounded-circle shadow" id="addHabit" aria-label="Add habit">+</button>
                </div>
            </div>

            <!-- Right Column: Stats -->
            <div class="col-md-4">
                <div class="column glass p-4 bg-dark text-light border border-secondary rounded-3">
                    <h2 class="mb-3 text-light">Player Stats</h2>
                    <div class="stats d-grid gap-3">
                        <% if (stats) { %>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span class="text-light">Strength</span><span class="text-light"><%= stats.strength || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-red" style="--p:<%= stats.strength || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span class="text-light">Agility</span><span class="text-light"><%= stats.agility || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-orange" style="--p:<%= stats.agility || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span class="text-light">Mental</span><span class="text-light"><%= stats.mental || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-purple" style="--p:<%= stats.mental || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span class="text-light">Work</span><span class="text-light"><%= stats.work || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-blue" style="--p:<%= stats.work || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span class="text-light">Social</span><span class="text-light"><%= stats.social || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-teal" style="--p:<%= stats.social || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span class="text-light">Financial</span><span class="text-light"><%= stats.financial || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-green" style="--p:<%= stats.financial || 0 %>;"></span></div>
                            </div>
                            <div>
                                <div class="d-flex justify-content-between mb-1"><span class="text-light">Speed</span><span class="text-light"><%= stats.speed || 0 %>%</span></div>
                                <div class="stat-bar"><span class="stat-yellow" style="--p:<%= stats.speed || 0 %>;"></span></div>
                            </div>
                            <% } else { %>
                                <p class="text-light-50">No stats available</p>
                                <% } %>
                    </div>
                </div>
            </div>


            <div class="modal bg-dark text-light" id="task-modal">
                <div class="modal-header bg-dark text-light border-secondary">
                    <span class="title">Add Task</span>
                    <span class="close-button" id="close-task-modal">&times;</span>
                </div>
                <div class="modal-body bg-dark text-light">
                    <input type="text" name="task" id="task-input" class="form-control bg-dark text-light border-secondary" placeholder="Enter your task" />
                    <select id="task-category" class="form-select bg-dark text-light border-secondary">
                        <option value="" disabled selected>Select Category</option>
                        <option value="Strength">Strength</option>
                        <option value="Agility">Agility</option>
                        <option value="Mental">Mental</option>
                        <option value="Work">Work</option>
                        <option value="Social">Social</option>
                        <option value="Financial">Financial</option>
                        <option value="Speed">Speed</option>
                    </select>
                    <button id="modal-add-task" class="btn btn-outline-light mt-2">Add Task</button>
                </div>
            </div>
            <div class="modal bg-dark text-light" id="habit-modal">
                <div class="modal-header bg-dark text-light border-secondary">
                    <span class="title">Add Habit</span>
                    <span class="close-button" id="close-habit-modal">&times;</span>
                </div>
                <div class="modal-body bg-dark text-light">
                    <input type="text" name="habit" id="habit-input" class="form-control bg-dark text-light border-secondary" placeholder="Enter your habit" />
                    <select id="habit-category" class="form-select bg-dark text-light border-secondary">
                        <option value="" disabled selected>Select Category</option>
                        <option value="Strength">Strength</option>
                        <option value="Agility">Agility</option>
                        <option value="Mental">Mental</option>
                        <option value="Work">Work</option>
                        <option value="Social">Social</option>
                        <option value="Financial">Financial</option>
                        <option value="Speed">Speed</option>
                    </select>
                    <button id="modal-add-habit" class="btn btn-outline-light mt-2">Add Habit</button>
                </div>
            </div>
            <div id="overlay"></div>


    </main>

    <div id="user-info" data-user-id="<%= userId %>"></div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/frontendJS/homeFE.js"></script>
</body>

</html>